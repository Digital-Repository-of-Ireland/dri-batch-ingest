<div class="fuelux" style="width:900px">
  <div class="wizard" data-initialize="wizard" id="ingestManifestWizard">
    <div class="steps-container">
        <ul class="steps">
            <li data-step="1" data-name="collection" class="active">
                <span class="badge">1</span>Collection
                <span class="chevron"></span>
            </li>
            <li data-step="2">
                <span class="badge">2</span>Manifest
                <span class="chevron"></span>
            </li>
        </ul>
    </div>
    <div class="actions">
        <button type="button" class="btn btn-default btn-prev">
            <span class="glyphicon glyphicon-arrow-left"></span>Prev</button>
        <button type="button" class="btn btn-primary btn-next" data-last="Complete">Next
            <span class="glyphicon glyphicon-arrow-right"></span>
        </button>
    </div>
    <div class="step-content">
      <div class="step-pane active alert" data-step="1">
        <%= form_tag(batch_ingest_path, id: 'manifest_form', method: 'post') do %>
          <%= hidden_field_tag 'type', 'manifest' %>
          <%= hidden_field_tag 'collection' %>

          <%= render partial: 'collection_dropdown' %>
      </div>
      <div class="step-pane alert" data-step="2">
          <h4>Select manifest from storage</h4>

          <%= button_tag("Browse", type: 'button', class: 'btn btn-large btn-success', id: "browse-btn",
            'data-toggle' => 'browse-everything', 'data-route' => browse_everything_engine.root_path,
            'data-target' => '#manifest_form' ) %>
          
        <p id="status">0 items selected</p>
        </div>
        <% end %>
      </div>
  </div>

  <script>
    $(document).ready(function() {
      $('#browse-btn').browseEverything()
        .done(function(data) { $('#status').html(data.length.toString() + " items selected") })
        .cancel(function()   { window.alert('Cancelled!') });
    });
  
    //buttons
    $('#ingestManifestWizard').on('finished.fu.wizard', function (e, data) {
      if (typeof $('#ingestManifestWizard #collectionCombobox').combobox('selectedItem').value !== 'undefined') { 
          $('#ingestManifestWizard #collection').val($('#ingestWizard #collectionCombobox').combobox('selectedItem').value)
      } else {
          $('#ingestManifestWizard #collection').val($('#ingestWizard #collectionCombobox').combobox('selectedItem').text)
      }

      $('#manifest_form').submit();
    });

    $('#ingestManifestWizard').on('actionclicked.fu.wizard', function (e, data) {
      if (data.step === 1 && data.direction === 'next') {
        if ($('#ingestManifestWizard #collectionCombobox').combobox('selectedItem').text == '') {
          alert('You must enter a collection ID.');
          return e.preventDefault();
        }
      }
    });
  </script>
</div>